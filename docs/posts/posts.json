[
  {
    "path": "posts/2022-02-23-principal-component-analysis-with-world-happiness-data/",
    "title": "World Happiness Report",
    "description": "Analysis and visualizations of world happiness data using principal component analysis.",
    "author": [
      {
        "name": "Renee Lamanna",
        "url": {}
      }
    ],
    "date": "2022-02-23",
    "categories": [],
    "contents": "\nOverview\nThe “World Happiness Report”, compiled and provided by the Sustainable Development Solutions Network is a landmark survey of the state of global happiness. World Happiness Reports began in 2012 and have since been recognized by governments and organizations as a tool to assess the progress of nations. This analysis uses Principal Component Analysis (PCA) to explore 7 different variables among 149 countries within 10 regions in the year 2019. The variables explored include: happiness score (score), per-capita GDP (gdp_per_capita), social support (social_support), the average life expectancy (life_expectancy), freedom to make life choices (freedom), generosity (genorisity), and perception of corruption (corruption). It should be noted that the variables have no impact on the total score as the happiness score is individually measured through surveying. However, some of the variables can help explain why some countries have higher happiness scores than others.\nData citation Sustainable Development Solutions Network. 2015, 2019. World Happiness Report. Gallup World Poll. https://www.kaggle.com/unsdsn/world-happiness?select=2019.csv\n\n\n# Set code chunk options and attach necessary pkgs\nknitr::opts_chunk$set(echo = TRUE, message=FALSE, warning=FALSE)\nlibrary(tidyverse)\nlibrary(here)\nlibrary(janitor)\n\n### For part 1, PCS:\nlibrary(ggfortify)\nlibrary(factoextra) \nlibrary(FactoMineR)\n\n\n\n\n\n# Read in data using here() and read_csv() and then change to lowersnake case using clean_names()\nhappy <- read_csv(here(\"_posts\", \"data\", \"2019_happy.csv\")) %>% \n  clean_names()\n\nhappy_2015 <- read_csv(here(\"_posts\", \"data\", \"2015_happy.csv\")) %>% \n  clean_names()\n\n\n\nPrincipal Components Analysis (PCA)\n\n\nhappy_clean <- happy %>% \n  rename(life_expectancy = healthy_life_expectancy, # Rename some variables\n         freedom = freedom_to_make_life_choices,\n         corruption = perceptions_of_corruption,\n         country = country_or_region)\n\n# Prepare the 2015_happy data for joining, we are joining by country so we can associate regions to country since the 2019 data does not contain region\nhappy_2015_clean <- happy_2015 %>% \n   select(country, region)\n\nhappy_regions <- happy_clean %>% \n  full_join(happy_2015_clean) %>% \n  drop_na() %>% # Drop N/A values, can't be used in PCA\n  mutate(region = as.factor(region))\n\n\n\n\n\nset.seed(12) # set seed to avoid random behavior of labels when knitting\n\nhappy_pca <- happy_regions %>% \n  select(score:corruption) %>%  # Have to get rid of anything that is not numeric, or not important to our analysis\n  scale() %>% \n  prcomp() \n\n\n\nPCA: Contribution of Variables\n\n\nfviz_pca_var(happy_pca,\n             col.var = \"contrib\", # Color by contributions to the PC\n             gradient.cols = c(\"#00AFBB\", \"#E7B800\", \"#FC4E07\"), # Set gradient\n             repel = TRUE,     # Avoid text overlapping\n             legend.title = (color = \"% Contribution\")) + \n  \n  labs(title = \" \", x = \"PC1 (54.9%)\", y = \"PC2 (19.8%)\")\n\n\n\n\nFigure 1. PCA of 7 different variables collected to measure happiness around the world. The colors of each vector indicate the percentage of the explained variance that is captured by each variable (contribution). The angles between each of the variables indicate their correlation to each other (0° angle = correlation of 1, 180° = correlation of -1, 90° or 270° = correlation of 0). The axis specify the total amount of variance explained by the given variables.\nPCA: Biplot 1\n\n\nset.seed(25) # set seed to avoid random behavior of labels when knitting\n\nfviz_pca_biplot(happy_pca,\n                \n                # Aesthetic changes for variables\n                col.var = \"black\", # Indicate variable lines as black\n                repel = TRUE,     # Avoid text overlapping,\n                label = \"var\" , # Labels for variables, but not observations\n    \n                # Aesthetic changes for observations\n                mean.point = FALSE, # Remove mean points from being included\n                geom.ind = \"point\", \n                fill.ind = happy_regions$region, # Fill of points corresponding to region w/in `happy_regions` dataset\n                palette = c(\"pink\", \"mediumaquamarine\", \"orangered\", \"mediumblue\", \"gold\", \"red\", \"lightskyblue\", \"firebrick4\", \"darkgreen\", \"darkorange\"),\n                col.ind = \"white\", # Outline of observations is \"white\"\n                pointshape = 21 ,\n                pointsize = 2,\n                alpha.ind= 0.7,\n                legend.title = (color = \"Region\")) +\n  \n  labs(title = \" \", x = \"PC1 (54.9%)\", y = \"PC2 (19.8%)\" )\n\n\n\n\nFigure 2. PCA biplot in which observations are represented by points, each of which are a country within a given region. Variables are indicated by lines (vectors) and the angle between two given variables indicates their relationship (0° angle = correlation of 1, 180° = correlation of -1, 90° or 270° = correlation of 0). The axis specify the total amount of variance explained by the given variables.\nPCA: Biplot 2\n\n\nset.seed(25) # set seed to avoid random behavior of labels when knitting\n\nhappy_pca_gdp <- happy_regions %>% \n  select(score, social_support:corruption) %>% # Here, not including gdp, because including sliding gradient of gdp that will correspond to observations(counties)\n  scale() %>% \n  prcomp()\n\nfviz_pca_biplot(happy_pca_gdp, \n                \n                # Aesthetic changes for variables\n                col.var = \"black\",\n                repel = TRUE, # Avoid text overlapping,\n                label =\"var\",\n    \n                # Aesthetic changes for observations\n                mean.point = FALSE,\n                geom.ind = \"point\",\n                fill.ind = happy_regions$gdp_per_capita, \n                col.ind = \"white\",\n                gradient.cols = c(\"#00AFBB\", \"#E7B800\", \"#FC4E07\"),\n                pointshape = 21 ,\n                pointsize = 2 ,\n                alpha.ind=1 ,\n                legend.title = (color = \"GDP\")) +\n  \n  labs(title = \" \", x = \"PC1 (52%)\", y = \"PC2 (21.9%)\" )\n\n\n\n\nFigure 3. Biplot of principal components analysis (PCA) in which observations are represented by points, each of which are individual countries. Their associated colors correspond to the per capita GDP of their country. Note that GDP was removed as a variable as it is represented within each observation in this figure. Variables are indicated by lines (vectors) and the angle between two given variables indicates their relationship (0° angle = correlation of 1, 180° = correlation of -1, 90° or 270° = correlation of 0). The axis specify the total amount of variance explained by the given variables.\nConclusion\nIn the principal component analysis of the “World Happiness Report”, the variables life_expectancy, social_support, and gdp_per_capita have a correlation of about 1. Score has a correlation of about 0.5 with life_expectancy, social_support, and gdp_per_capita. This is relatively consistent to what one might predict determines happiness within a region. There also appears to be a small correlation between freedom and corruption and possibly between generosity and corruption, but these relationships are less intuitive. Generosity has a correlation of about 0 to the following variables: score, life expectancy, gdp, and social support. In figure 2, there are some observable clusters of regions such as countries in Sub-Saharan Africa. There are also clusters of countries within North America and Western Europe. In figure 3, there are clusters of GDP among countries. In general, countries with the highest GDPs are clustered together and counties with the lowest are clustered together. Countries with mid-GDP’s do not show as much defined clustering. From this analysis, it can be concluded that the variables contributing the most and positively correlated to happiness score are social support, GDP, and average life expectancy. In general, we can also see clustering (similarity) among countries within the same region as well as clustering of countries with relatively the same per capita GDP.\n\n\n\n",
    "preview": "posts/2022-02-23-principal-component-analysis-with-world-happiness-data/principal-component-analysis-with-world-happiness-data_files/figure-html5/unnamed-chunk-4-1.png",
    "last_modified": "2022-02-23T12:49:08-08:00",
    "input_file": {}
  },
  {
    "path": "posts/2022-02-23-sbc-lter-stream-water-chemistry/",
    "title": "SBC-LTER Stream Water Chemistry",
    "description": "Agglomerative Hierarchical Clustering For Water Chemistry of Santa Barbara Streams.",
    "author": [
      {
        "name": "Renee Lamanna",
        "url": {}
      }
    ],
    "date": "2022-02-23",
    "categories": [],
    "contents": "\nOverview\nThe data for this analysis contains stream water chemistry measurements of Santa Barbara county watersheds beginning in 2000 and continuing annually completed by the Santa Barbara Coastal LTER. Measurements were taken for the following physical variables: dissolved nitrogen (nitrate, ammonium, total dissolved nitrogen); soluble reactive phosphorus (SRP); particulate organic carbon, nitrogen and phosphorus; total suspended sediments; and conductivity. 13 different sites and 10 different physical variables are explored using agglomerative hierarchical clustering. Hierarchical clustering by both complete and single linkage are visualized using dendrograms. A tanglegram is then used to further explore the difference between single and complete linkage hierarchical clustering.\nData citation Santa Barbara Coastal LTER and J. Melack. 2019. SBC LTER: Land: Stream chemistry in the Santa Barbara Coastal drainage area, ongoing since 2000 ver 16. Environmental Data Initiative. https://doi.org/10.6073/pasta/67a558a24ceed9a0a5bf5e46ab841174\n\n\n# Read in data using here() and read_csv() and then change to lowersnake case using clean_names()\nstreams <- read_csv(here(\"_posts\", \"data\", \"sbc_lter_registered_stream_chemistry.csv\")) %>% \n  clean_names()\n\n\n\nHierarchical Clustering\nHierarchical clustering by both complete and single linkage are completed to create dendrograms showing multivariate clustering for water chemistry by site.\n\n\nclean_streams <- streams %>% \n  group_by(site_code) %>% \n  replace_with_na(replace = list(x = -999.0)) %>% # Replace -999.0 values w/ NA\n  summarize( # Summarize by mean of each physical variable and remove NAs\n    mean(nh4_u_m, na.rm = FALSE),\n    mean(no3_u_m, na.rm = FALSE),\n    mean(po4_u_m, na.rm = FALSE),\n    mean(tdn_u_m, na.rm = FALSE),\n    mean(tdp_u_m, na.rm = FALSE),\n    mean(tpc_u_m, na.rm = FALSE),\n    mean(tpn_u_m, na.rm = FALSE),\n    mean(tpp_u_m, na.rm = FALSE),\n    mean(tss_mgper_liter, na.rm = FALSE),\n    mean(spec_cond_u_spercm, na.rm = FALSE))  %>% \n  mutate(site = case_when(\n    site_code == \"AB00\" ~ \"Arroyo Burro\",\n    site_code == \"AT07\" ~ \"Atascadero\",\n    site_code == \"BC02\" ~ \"Bell Canyon\",\n    site_code == \"DV01\" ~ \"Devereaux\",\n    site_code == \"GV01\" ~ \"Gaviota\",\n    site_code == \"HO00\" ~ \"Arroyo Hondo\",\n    site_code == \"MC00\" ~ \"Montecito St.\",\n    site_code == \"MC06\" ~ \"Rocky Nook\",\n    site_code == \"ON02\" ~ \"San Onofre\",\n    site_code == \"RG01\" ~ \"Refugio\",\n    site_code == \"RS02\" ~ \"Rattlesnake\",\n    site_code == \"SP02\" ~ \"San Pedro\",\n    site_code == \"TO02\" ~ \"Tecolote\"\n  ))\n\n\n\n\n\nstreams_scaled <- clean_streams %>% # Scale data\n  select(2:10) %>% \n  scale()\n    \nrownames(streams_scaled) <- clean_streams$site # Site names were previously dropped, need to add back in \n\neuc_distance <- dist(streams_scaled, method = 'euclidean', diag = TRUE, upper = TRUE)     # Calculate euclidean distance\n\n\n\nComplete dendrogram\n\n\nhc_complete <- hclust(euc_distance, method = 'complete') # Indicate complete as method\n  \nhc_complete %>% \n  as.dendrogram() -> dend_complete # Store as dendrogram\n\ndend_complete %>%  # Customization to linkages\n  set(\"labels_col\", value = c(\"skyblue\", \"orange\", \"grey\"), k=3) %>%\n  set(\"branches_k_color\", value = c(\"skyblue\", \"orange\", \"grey\"), k = 3) %>%\n  plot(horiz=FALSE, axes=TRUE)\nabline(v = 350, lty = 2)\n\n\n\n\nFigure 1. Dendrogram of hierarchical clustering by complete linkage. The sites within Santa Barbara county are listed along the x-axis and distance along the y. 3 different multivariate clusters were estimated and are specified by color.\nSingle dendrogram\n\n\nhc_single <- hclust(euc_distance, method = 'single') # Indicat single as method\n\nhc_single %>% \n  as.dendrogram() -> dend_single # Store as a dendrogram\n\ndend_single %>% \n  set(\"labels_col\", value = c(\"skyblue\", \"orange\", \"grey\", \"darkseagreen\"), k=4) %>%\n  set(\"branches_k_color\", value = c(\"skyblue\", \"orange\", \"grey\", \"darkseagreen\"), k = 4) %>%\n  plot(horiz=FALSE, axes=TRUE)\nabline(v = 350, lty = 2)\n\n\n\n\nFigure 2. Dendrogram of hierarchical clustering by single linkage. The sites within Santa Barbara county are listed along the x-axis and distance along the y. 4 different multivariate clusters were estimated and are specified by color.\nTanglegram\n\n\n# Prepare dendrograms for tanglegram, put into list and set customizations\ndl <- dendlist(\n  dend_complete %>% \n    set(\"labels_col\", value = c(\"skyblue\", \"orange\", \"grey\"), k=3) %>%\n    set(\"branches_lty\", 1) %>%\n    set(\"branches_k_color\", value = c(\"skyblue\", \"orange\", \"grey\"), k = 3),\n  dend_single %>% \n    set(\"labels_col\", value = c(\"skyblue\", \"orange\", \"grey\", \"darkseagreen\"), k=4) %>%\n    set(\"branches_lty\", 1) %>%\n    set(\"branches_k_color\", value = c(\"skyblue\", \"orange\", \"grey\", \"darkseagreen\" ), k = 4)\n)\n\ntanglegram(dl, \n           common_subtrees_color_lines = FALSE, \n           highlight_distinct_edges  = TRUE, \n           highlight_branches_lwd = FALSE,\n           margin_inner=7, # Set innter distance b/w the dendrograms and connecting lines\n           lwd = 2)\n\n\n\n\nFigure 3. Tanglegram to compare hierarchical clustering by single linkage and complete linkage. The dendrogram on the left is of complete linkage and has 3 identified clusters and the dendrogram on the right is of single linkage and has 4 identified clusters. Connected lines show sub-trees which are present in both dendrograms.\nConclusion\nHierarchical clustering by single linkage and complete linkage show some variation in multivariate clustering. Single linkage reveals one additional cluster than complete linkage. In both single and complete linkages, multivariate clustering can be seen among some of the Santa Barbara creeks sites given the physical variables. Furthermore, clustering among sites suggest similarity of water chemistry measurements between sites. Connected lines in figure 3 of the tanglegram also indicate some sub-trees that are present in both dendrograms.\n\n\n\n",
    "preview": "posts/2022-02-23-sbc-lter-stream-water-chemistry/sbc-lter-stream-water-chemistry_files/figure-html5/unnamed-chunk-4-1.png",
    "last_modified": "2022-02-23T12:52:44-08:00",
    "input_file": {}
  }
]
